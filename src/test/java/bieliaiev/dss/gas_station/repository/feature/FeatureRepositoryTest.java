package bieliaiev.dss.gas_station.repository.feature;

import bieliaiev.dss.gas_station.model.feature.Feature;
import bieliaiev.dss.gas_station.model.feature.FeatureGroup;
import jakarta.transaction.Transactional;
import org.junit.jupiter.api.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;

import java.util.List;

import static org.assertj.core.api.Assertions.assertThat;

@Transactional
@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
class FeatureRepositoryTest {

    private final FeatureGroupRepository groupRepo;
    private final FeatureRepository featureRepo;
    private FeatureGroup group;

    @Autowired
    public FeatureRepositoryTest(FeatureGroupRepository groupRepo, FeatureRepository featureRepo) {
        this.groupRepo = groupRepo;
        this.featureRepo = featureRepo;
    }

    @Test
    public void saveFeature() {
        group = new FeatureGroup("E", "Economical");
        Feature feature = new Feature(1, "FEATURE_DESCRIPTION");
        group.setFeatures(List.of(feature));

        group = groupRepo.save(group);

        Feature saved = group.getFeatures().getFirst();

        assertThat(saved.getDescription()).isEqualTo("FEATURE_DESCRIPTION");
        assertThat(saved.getId()).isNotNull();
        assertThat(groupRepo.findById(group.getId()).orElseThrow().getFeatures()).containsExactlyInAnyOrder(saved);
    }
}